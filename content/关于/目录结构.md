---
title: "目录结构"
date: 2015-04-10 16:31
---
[TOC]


介绍微度日历的目录结构

client(客户端代码)
========


css(全局样式)
-------

###fontAwesome(icon-font的辅助样式)


###globals(全局的样式)

```
- base.import.less              清除默认样式
- list-items.import.less                    
- button.import.less            按钮的样式
- menu.import.less
- form.import.less        
- message.import.less
- header.import.less            header头的样式
- nav.import.less
- layout.import.less      
- notification.import.less      通知的样式
- link.import.less        
- sidebar.import.less 
```

###util(样式辅助工具)

```
- helpers.import.less           一些全局的辅助样式，值得注意的为.position
- reset.import.less     
- typography.import.less
- lesshat.import.less                       自动加前缀的工具，遇到兼容性问题就进来查，比较重要的文件
- text.import.less    
- variables.import.less         所有的变量，尽量不要在零散的css里面写颜色和数值，后期不好修改，请把所有公共的变量写入这个文件，十分重要！！！！
```

###main.less(引用所需的less文件)   

如果有新的less文件记得引入进来，否则是不起作用的，用法为`@import 'globals/base.import.less'`

lib(前台公用代码)
-------

###common.coffee(前台公共函数)

声明了`Common.client`命名空间,前台的公共函数全部存储到其中

`Common.client.static`为静态资源的命名空间

####时间操作

#####switchDate(type: String, back: Boolean)

```
参数: type值为['days', 'weeks', 'months'],back为true时,为后退
功能:切换日期的时间函数,例如在切换上一月下一月,前一天后一天
原理:通过moment.js做日期的增减操作,然后操作Session
```

#####setCuTime(data)

```
参数:data = {
    year,
    month,
    date
}
功能:设置当前时间
原理:通过控制Session切换当前时间
```

#####goToday()
`跳转到当前系统时间`

#####createMonth()
`生成当月的数据,主要使用在月视图`

#####filterByHour(collection, date)

```
参数: collection为数组,从数据库中查询后fetch的数据
     date = {
     year: Number
     month: Number
     date: Number
     hour: Number
}
功能: 根据起始时间筛选数据,主要使用在计算待办事项
```

####页面效果

#####showModal(templateName, data, dom)   ---  重要!

```
参数: templateName弹出层的模板名, data为渲染弹出层的数据, dom为插入的地方,默认是body
功能: 删除前一个弹出层,并新渲染一个弹出层,避免同时存在的弹出层太多,不好管理的问题,请使用新弹出层的时候以这个方法来插入
```

####数据相关

#####allShareMember()

`在弹出层中计算出当前能分享的人和群组,用于新建日程和修改日程`

####订阅操作

#####subfriendInfo()

`再次订阅friendInfo数据,原因是因为Meteor.users不是活性数据`

#####refreshSub(name)

`刷新订阅数据`

#####subNotificationName(arr)

`根据消息id来订阅回消息的描述`

###registerHelper.coffee(全局的helper方法)

####{{readAvatar id}}

```
参数: 用户id
功能: 返回用户的头像
原理: 查用户的icon字段,如果是二进制的就返回,如果不是就去线上读
```

####{{getNotifyName obj}}

```
参数: obj = {
    operate_id: String
    target_id: String
    event_type: String
}
功能: 根据消息的信息组合出消息的内容
```

###setting.coffee(前台第三方的插件设置)

第三方弹出框的设置
```
effect:    动画类型
position:  出现的位置
timeout:   出现的时间
```

view(视图代码)
-------

###auth(登陆注册)

####auth-join.coffee

> 注册的js文件，后期需要调整的也就是`Template.join.events`里面的两个事件了

> **这里需要注意的是，如果登陆有错误信息，请写入`Session.set(ERRORS_KEY, value)`**

> **注册发验证码仍为未完成状态，请完善**

####auth-join.html

> 注册的页面文件，没什么需要改动的

####auth-signin.html

> 登陆的页面，没什么好需要改动的地方

####auth-signin.js

> 登陆的js文件

####auth.import.less

> 登陆注册的样式文件

###calendar(日历主文件)

####calendar-detail.coffee

> 日历版块的一些小事件，不太重要，主要功能有右侧迷你日历的一些事件，还有中间顶部选项卡的事件

> 需要注意的是`Common.client.switchDate`函数,第一个参数是需要变换的类型,第二个是增还是减

####calendar-detail.html

> 日历部分主视图，主要是框架模板

####calendar-item.html

> 包含：

> 1. 今天的模板

> 2. 日视图模板

> 3. 周视图模板

> 4. 月视图模板

> 5. 每一条日程的模板

####calendar-item.import.css

> 以上5个模板的样式

####calendar.import.less

> 主要是calendar-detail.html的样式

####date-item.coffee

> 日程的逻辑，需要注意的是rendered和onDestroyed方法，

> rendered里面是新建日个日程然后计算该时段有的日程数，做width和left的重新赋值

> onDestroyed方法是删除一个日程的时候，重新计算该时段width和left的方法

> 具体细节请看注释

####day-view.cofeee

> 日视图的操作逻辑，需要注意的是`helpers`里面有个`hours`，这个的逻辑是,先找出一个人今天的任务(DB.Calendar.findByDate方法),然后根据小时去筛选(Common.client.filterByHour方法)

> 点击一个时段的方法中,`Common.client.showModal`是显示模态框的方法

####month-view.coffee

> 月视图的操作逻辑,需要注意的是`Common.client.createMonth()`方法,这个和小日历里面的显示逻辑是公用的,具体详情请看方法代码

> 'click .month-cal td'这个方法需要注意,这里是点击某一天,因为在共享模板里面是复用月视图模板的,所以这里针对路由做了判断处理

####today-view.coffee

> 今天视图的模板,需要注意的只有,`DB.Calendar.findNearlyDate`函数,第一个参数是类型,第二个是筛选出来的最大条数,默认5条

####week-view.coffee

> 周视图模板,大多数代码和日视图相同,逻辑复杂的地方主要是有`helper`中的`hours`,第一层循环是时间,但是因为每天的数据是一样的,所以我就把每天的时段存储在一个缓存变量中,这样就第一次处理的时候需要从数据库读取数据筛选,之后的时段就不需要了,这里有个coffee的用法就是

```javascript
arr = for i in [1,2,3,4]
    {
    a: i
}
```

> 这种写法的类似

```javascript
var arr = []
for(var i = 0; i < [1,2,3,4].length; i++) {
    arr.push({a: [1,2,3,4][i]});
}
```

###group(好友群组)

####group.coffee

> 群组页面的操作逻辑,需要注意的是,`Template.group.helpers`里面的`members`,这个地方用`transform`做了一下处理,筛选出了没同意的,和已经被拒绝的,注意,使用`transform`方法请在后面记得加上`.fetch()`

> 第二个值得注意的方法是`Template.friendInfo.helpers`中的`commonCal`,这个是计算和目标人员的共同任务用的

####group.html

> 群组模板

####group.import.less

> 群组模板的样式

###header(头部)

####header.coffee

> 头部状态了的逻辑,需要注意的是,这里包含了`Notification`的逻辑,`DB.Notification.eventType[eventType]`中,根据`dom`上的`data-event`字段来判断使用哪个方法,`DB.Notification`定义在`lib/collection/DB-notification.coffee`中

####header.html

> 头部状态栏的dom结构

###modal(模态框)

####add-group.coffee

> 添加群组的逻辑,这里需要注意的有:

> 1. `Schemas.addGroup`是创建了一个数据模型,调用了第三方的`autoform`插件,及其好用,具体请前往`atmosphere`上查看具体情况

> 2. 添加群组是调用`DB.Groups.addGroup`方法

> 3. 修改群组信息是`DB.Groups.updateMemberList`方法,退出群组就是变相的修改群组

####add-group.html

> 群组相关的模态框模板

####add-person.coffee

> 添加联系人的操作逻辑,需要注意:

> 1. `Meteor.call('findPerson')`方法,因为数据是在后台,没有抛到前台来,所以得在后台定义方法,前台调用

> 2. `click #modalConfirm`方法,如果是邀请人员没有补充

> 3. `DB.Friend.sendQueryAddPerson`申请添加好友的函数

####add-person.html

> 添加联系人的模态框模板

####modal.coffee

> 包含三个模板的操作逻辑: 添加日程,修改日程,个人设置

> 需要注意

> 1. 定义了一个schema,包含了一个日程的数据模型,使用auto-form自动生成表单

> 2. 添加日程的时候过程麻烦,逻辑不麻烦,修改也是一样

> 3. 注意rendered方法,主要是用来获取点击的时候的数据的,因为我的模态框每次点击都是先删除再添加,所以每次都会触发rendered事件

> 4. 个人设置中,上传头像用的方法是解析成二进制文件,然后存储在数据库中

####modal.html

> 包含三个模块:添加日程,修改日程,个人设置

####modal.import.less

> 所有模态框的样式

###share(分享)

####share.coffee

> 分享部分的模板,这里的members算的时候,是只算出了分享给你日历的人

####share.html

> 分享部分的模板

####share.import.less

>分享部分的所有样式

###sidebar(侧栏)

####sidebar.coffee

> 就一个选项卡

####sidebar.html

> 侧栏的模板

###toolTemplate(loading和404)

这里面都是todolist留下来的

###app-body.html(layout模板)

yield模板

###app-body.js(没啥用)

head.html(头文件)
--------


lib(前后台公用代码)
=======


public(静态资源)
======


server(后台代码)
======
